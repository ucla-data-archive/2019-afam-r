# Mapping in R

Two weeks ago we covered how to work with data in R and produce some plots.  Today we will learn how to do mapping in R. Let's start by using ggplot2 to plot our arrest data by longitude and latitude. 

## GGPLOT map 

How about we make a map with GGPLOT? We do this by using our longitude and latitude variables as our x and y mapping. 

```{r ggplot-map}
ggplot(arrests, aes(x=longitude, y=latitude)) + geom_point()
```

We can see the general shape of LA county, but there are limits to what you can do with geospatial data in ggplot. It doesn't know what to do with the latitude and longitude beyond adding the points to a plot. It has no sense of the layers we used in QGIS. But other R packages gives us these capabilities. 

## Mapping in R 

We need a way to tell arrests that it is a spatial object in R. To do that we need to use two spatial packages. Let's load them. 

```{r}
library(sf)
library(tmap)
```


## Converting data to a spatial object

`sf` stands for spatial features. `tmap` let's us plot maps like `ggplot`. Ok, first up, let's convert our `arrests` data to a spatial feature. We need to do this b/c `tmap` will need this information so we can use it on a map. I'll create a new data frame called `arrests_sf` and use the `st_as_sf()` that lets us convert our data frame to a `sf` object using the latitude and longitude. 

```{r}
arrests_sf <- st_as_sf(arrests, coords = c("longitude", "latitude"), crs = 4326)
```

Notice a couple of things you haven't seen before. We have a `coords` argument that we use a `c()` function to **combine** our `latitude` and `longitude` columns. We also tell the function what **Cordinate Refernce System** be are using `4326` is a common one.

Let's look at this new spatial data frame: 

```{r spatial-data-view, eval=FALSE}
View(arrests_sf)
```

We now have a column called `geometry` at the end of our data frame. This contains our latitude and longitude. 

One thing nice is that we can use the `plot()` function to plot our spatial data frame as it is. 

```{r}
plot(arrests_sf)
```

But the problem is that we still have no context for our points. We need the layers of polygons we had in QGIS to let us know this is LA. Let's look at this in a package called `tmaps` (thematic maps). 

```{r}
tm_shape(arrests_sf) + tm_dots()
```

## Reading in shapefiles

Nice, but again, we lack geographic boundaries and other shapes. Just like in QGIS, however, we can read in various shapefiles -- the ones ending in `.shp` -- to provide our map some boundaries. We do this by using the function `st_read`. Let's look at our help documentation on `st_read`. 

Inside our `data/` folder we have the shape files we used in our `QGIS` part of the class plus a new one on the LA county boundaries. Let's read them in individually and note the output in the console, especially the `geometry type`. 

```{r la_county}
#geometry type:  MULTILINESTRING
la_county <- st_read(dsn ="data/DRP_COUNTY_BOUNDARY/DRP_COUNTY_BOUNDARY.shp")
```

```{r la_zips}
#geometry type:  MULTIPOLYGON
la_zips <- st_read(dsn = "data/Los_Angeles_City_Zip_Codes/Los_Angeles_City_Zip_Codes.shp")
```

```{r la_freeways}
#geometry type:  MULTILINESTRING
la_freeways <- st_read(dsn ="data/CAMS_FREEWAY_SHIELDS/CAMS_FREEWAY_SHIELDS.shp")
```

Now let's use the layers. The important thing is we match our shapefile with the geometry type. `tm_polygons()` goes with `#geometry type:  MULTIPOLYGON` and `tm_line()` goes with `#geometry type:  MULTILINESTRING`. Let's use this new knowledge to make the map better. 

```{r tmap-mode-plot, echo=FALSE}
tmap_mode("plot")
```



```{r}
tm_shape(la_zips) +
  tm_polygons() +
tm_shape(la_freeways) +
  tm_lines() +
tm_shape(arrests_sf) +
  tm_dots() 
```

Ok, that's more like it. Last thing before we break. So far, we've been using `tmap` to produce a static map, but `tmap` lets us create interactive maps by switching it's mode to `view'. We can do this using a single line. 

```{r tmap-mode}
tmap_mode("view")
```

```{r tmap-view, eval=FALSE}
tm_shape(la_zips) +
  tm_polygons() +
tm_shape(la_freeways) +
  tm_lines() +
tm_shape(arrests_sf) +
  tm_dots() 
```
[aggre-larger-data]:# use dplyr to aggregate data by zipcode, then create a spatial dataset 
[map data]:# look at SapData package on how to set up spatial data as a package - add variants of arrests data
[add-color-other-theme]:# add color to the plot and different data, will need to prep
[write challenges]:# focus on faded examples - fill in the blank style
[write learning objectives]:# what do we want them to get out of the next few classes
[tmap-functions]:# add color via tm_border, tm_fill https://geocompr.robinlovelace.net/adv-map.html#aesthetics 
[tmap-functions]:#

